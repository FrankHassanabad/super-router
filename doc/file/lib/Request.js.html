<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">lib/Request.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="https://github.com/autoric/super-router" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Node.js~Node.html">Node</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Request.js~Request.html">Request</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Response.js~Response.html">Response</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Route.js~Route.html">Route</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Router.js~Router.html">Router</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/Request.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;
const _                = require(&apos;lodash&apos;);
const utils            = require(&apos;./utils&apos;);
const TransformStream  = require(&apos;stream&apos;).Transform;
const isReadableStream = require(&apos;isstream&apos;).isReadable;

/**
 * SuperRouter Request object.
 */
class Request {
  /**
   * Constructs a new request object.
   *
   * @param {object} options - The options object
   * @param {string} path - The request path
   * @param {string} method - The request method
   * @param {object} [headers={}] - The request headers
   * @param {ReadableStream} [body] - The request body stream
   * @returns {Request} Request object
   */
  constructor(options) {
    if (!_.isObject(options)) {
      throw new TypeError(&apos;options must be an object.&apos;);
    }

    const headers = options.headers;
    const body    = options.body;

    if (headers != null &amp;&amp; !_.isObject(headers)) {
      throw new TypeError(&apos;headers must be an object.&apos;);
    }
    if (body != null &amp;&amp; !isReadableStream(body)) {
      throw new TypeError(&apos;body must be a readable stream.&apos;);
    }

    this.path   = options.path;
    this.method = options.method;

    this._originalPath    = options.originalPath || options.path;
    this._headers         = new Map();
    _.each(headers, (v, k) =&gt; {
      this._headers.set(k.toLowerCase(), v);
    });
    this._body            = new TransformStream();
    this._body._transform = function (chunk, encoding, done) {
      return done(null, chunk);
    };
    if (isReadableStream(body)) {
      body.pipe(this._body);
    }

    _.each(options, (v, k) =&gt; {
      if (_.isUndefined(this[k])) {
        this[k] = v;
      }
    });
  }

  /**
   * Returns the original path of the request. The original path is the path that the request
   * was initialized with, and cannot be changed, even if the path is later updated.
   *
   * @returns {string} - Original path
   */
  get originalPath() {
    return this._originalPath;
  }

  /**
   * Returns the request path
   *
   * @returns {string} - Request path
   */
  get path() {
    return this._path;
  }

  /**
   * Sets the request path.
   *
   * @param {string} path - The new request path
   * @returns {void}
   */
  set path(path) {
    if (!_.isString(path)) {
      throw new TypeError(&apos;path must be a string.&apos;);
    }
    this._path = utils.normalizePath(path);
  }

  /**
   * Returns the request method. Request method will be lower-cased.
   *
   * @returns {string} - The request method.
   */
  get method() {
    return this._method;
  }

  /**
   * Sets the request method. Input is case-insensitive.
   *
   * @param {string} method - The new request method.
   * @returns {void}
   */
  set method(method) {
    if (!(utils.isValidMethod(method))) {
      throw new TypeError(&apos;method must be a valid method string.&apos;);
    }
    this._method = utils.normalizeMethod(method);
  }

  /**
   * Returns the request headers as a plain object. Keys and values are lower-cased.
   *
   * @returns {object} - The request headers.
   */
  get headers() {
    const obj = {};
    for (const kv of this._headers) {
      obj[kv[0]] = kv[1];
    }

    return obj;
  }

  /**
   * Returns the value of a request header. Input is case-insensitive.
   *
   * @param {string} key - The request header key
   * @returns {string} - The request header value
   */
  getHeader(key) {
    return this._headers.get(key.toLowerCase());
  }

  /**
   * Returns the underlying request body stream.
   *
   * @returns {TransformStream} - The request body stream.
   */
  get body() {
    return this._body;
  }

  /**
   * Sets the request body value.
   *
   * @param {*} val - The new request body value.
   * @returns {void}
   */
  set body(val) {
    this._body = val;
  }

  /**
   * Returns a string representation of the request
   *
   * @returns {string} - representation of the request
   */
  toString() {

    const copyOfHeaders = _.clone(this.headers);
    const authInfo = copyOfHeaders.authorization;
    if (authInfo != null) {
      copyOfHeaders.authorization = `...${authInfo.slice(-4)}`;
    }

    return `Request: ${JSON.stringify({
      method  : this.method,
      path    : this.path,
      headers : copyOfHeaders,
      body    : this.body
    }, null, 2)}`;
  }
}

module.exports = Request;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.1)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
