<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">lib/Router.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="https://github.com/autoric/super-router" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Node.js~Node.html">Node</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Request.js~Request.html">Request</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Response.js~Response.html">Response</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Route.js~Route.html">Route</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/Router.js~Router.html">Router</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/Router.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

const Route     = require(&apos;./Route&apos;);
const RouteTree = require(&apos;./RouteTree&apos;);

const SPLAT    = /\*/;
const OPTIONAL = /\(/;

/**
 * SuperRouter Router object
 */
class Router {
  constructor() {
    this._routesTree = new RouteTree();

    this.match   = this.match.bind(this);
    this.execute = this.execute.bind(this);
  }

  /**
   * Adds a route to the router. Routes must be unique and deterministic (no splats or optionals). Routes can
   * be annotated with additional information, will be available on the Request after matching.
   *
   * Any route parameters defined in the path will be available on the request.routeParams object when the
   * handler is executed.
   *
   * If the route handler returns a promise, the app will wait for that promise to resolve or reject before
   * moving to the next middleware in the stack.
   *
   * @example
   * router.addRoute({
   *  path : &apos;/cases/:caseId&apos;,
   *  methods : &apos;get&apos;,
   *  handler : ({request, response}) =&gt; {
   *    return Database.getCaseById(request.routeParams.caseId).then((caseInstance) =&gt; {
   *      request.setBody(caseInstance);
   *    });
   *  }
   * });
   *
   * @param {Route} route - The route definition. If a plain object is provided, will be run through the
   *   Route constructor.
   * @returns {void}
   */
  addRoute(route) {
    if (!(route instanceof Route)) {
      route = new Route(route);
    }

    if (route.path.match(SPLAT) || route.path.match(OPTIONAL)) {
      throw new TypeError(&apos;Splats and optional groups are not supported for routes.&apos;);
    }

    this._routesTree.addRoute(route);
  }

  /**
   * Middleware to be consumed by a SuperRouter App instance. Causes a request to be matched against
   * the router. The matched route will be assigned to `request.matchedRoute`. In the case of no match,
   * the middleware does not throw an error; the matchedRoute key will simply be undefined.
   *
   * @example
   * app.then(router.match);
   *
   * @param {object} options - The request &amp; response used by app middleware.
   * @returns {void}
   * @throws an error with a code of 404 if no match is found
   */
  match(options) {
    const request = options.request;

    request.matchedRoute = this._routesTree.find(request);

    if (request.matchedRoute == null) {
      const error = new Error(`No route matched ${request.path}`);
      error.name = &apos;PathNotFound&apos;;
      error.statusCode = 404;
      throw error;
    }
  }

  /**
   * Middleware to be consumed by a SuperRouter App instance. Causes the handler of a matched route to
   * be executed. If `request.matchedRoute` is not defined, the middleware does nothing.
   *
   * @example
   * app.then(router.execute);
   *
   * @param {object} options - The request &amp; response used by app middleware.
   * @returns {void}
   */
  execute(options) {
    const request  = options.request;
    const response = options.response;

    if (request.matchedRoute != null) {
      return request.matchedRoute.execute({ request, response });
    }
  }

}

module.exports = Router;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.1)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
